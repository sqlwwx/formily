{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/upload/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { Field } from '@formily/core'\nimport { defineComponent } from '@vue/composition-api'\nimport { connect, mapProps, h, useField, Fragment } from '@formily/vue'\n\nimport type {\n  ElUpload as ElUploadProps,\n  ElUploadInternalFileDetail,\n} from 'element-ui/types/upload'\n\nimport { Upload as ElUpload, Button as ElButton } from 'element-ui'\n\nexport type UploadProps = ElUploadProps & {\n  textContent?: String\n  errorAdaptor?: (error?: ErrorEvent) => String\n}\n\nconst UploadWrapper = defineComponent<UploadProps>({\n  name: 'FUpload',\n  props: {\n    textContent: {\n      type: String,\n      default: '',\n    },\n    errorAdaptor: {\n      type: Function,\n      default(error?: ErrorEvent) {\n        return error?.message || ''\n      },\n    },\n  },\n  setup(curProps: UploadProps, { slots, attrs, listeners, emit }) {\n    return () => {\n      const fieldRef = useField<Field>()\n      const setFeedBack = (error?: ErrorEvent) => {\n        const message = curProps.errorAdaptor(error)\n\n        fieldRef.value.setFeedback({\n          type: 'error',\n          code: 'UploadError',\n          messages: message ? [message] : [],\n        })\n      }\n\n      const props = {\n        ...attrs,\n        onChange(\n          file: ElUploadInternalFileDetail,\n          fileList: ElUploadInternalFileDetail[]\n        ) {\n          ;(attrs.onChange as Function)?.(file, fileList)\n          setFeedBack()\n          emit('change', fileList)\n        },\n\n        onRemove(\n          file: ElUploadInternalFileDetail,\n          fileList: ElUploadInternalFileDetail[]\n        ) {\n          ;(attrs.onRemove as Function)?.(file, fileList)\n          setFeedBack()\n          emit('change', fileList)\n        },\n\n        onError(\n          error: ErrorEvent,\n          file: ElUploadInternalFileDetail,\n          fileList: ElUploadInternalFileDetail[]\n        ) {\n          ;(attrs.onError as Function)?.(error, file, fileList)\n\n          setTimeout(() => {\n            setFeedBack(error)\n          }, 0)\n        },\n      }\n      const children = {\n        ...slots,\n      }\n      if (!slots.default) {\n        children.default = () => {\n          const listType = attrs.listType\n          const drag = attrs.drag\n\n          if (drag) {\n            return h(\n              Fragment,\n              {},\n              {\n                default: () => [\n                  h('i', { staticClass: 'el-icon-upload' }, {}),\n                  h(\n                    'div',\n                    { staticClass: 'el-upload__text' },\n                    { default: () => [curProps.textContent] }\n                  ),\n                ],\n              }\n            )\n          }\n\n          if (listType === 'picture-card') {\n            return h(\n              'i',\n              {\n                staticClass: 'el-icon-plus',\n              },\n              {}\n            )\n          }\n\n          return h(\n            ElButton,\n            { props: { icon: 'el-icon-upload2' } },\n            { default: () => [curProps.textContent] }\n          )\n        }\n      }\n      return h(ElUpload, { attrs: props, on: listeners }, children)\n    }\n  },\n})\n\nexport const Upload = connect(\n  UploadWrapper,\n  mapProps({ readOnly: 'readonly', value: 'fileList' })\n)\n\nexport default Upload\n"]}
{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/array-collapse/index.ts"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA,wDAA6E;AAC7E,yCAA4E;AAM5E,oCAMqB;AACrB,sDAAgD;AAEhD,mDAAqD;AACrD,4CAAyC;AACzC,iDAAsD;AAMtD,IAAM,mBAAmB,GAAG,UAAC,MAAe;;IAC1C,OAAO,CAAA,MAAA,MAAM,CAAC,aAAa,CAAC,0CAAE,OAAO,CAAC,UAAU,CAAC,IAAG,CAAC,CAAC,CAAA;AACxD,CAAC,CAAA;AAED,IAAM,gBAAgB,GAAG,UAAC,MAAe;;IACvC,OAAO,CAAA,MAAA,MAAM,CAAC,aAAa,CAAC,0CAAE,OAAO,CAAC,OAAO,CAAC,IAAG,CAAC,CAAC,CAAA;AACrD,CAAC,CAAA;AAED,IAAM,iBAAiB,GAAG,UAAC,MAAe;;IACxC,OAAO,CAAA,MAAA,MAAM,CAAC,aAAa,CAAC,0CAAE,OAAO,CAAC,QAAQ,CAAC,IAAG,CAAC,CAAC,CAAA;AACtD,CAAC,CAAA;AAED,IAAM,iBAAiB,GAAG,UAAC,MAAe;;IACxC,OAAO,CAAA,MAAA,MAAM,CAAC,aAAa,CAAC,0CAAE,OAAO,CAAC,QAAQ,CAAC,IAAG,CAAC,CAAC,CAAA;AACtD,CAAC,CAAA;AAED,IAAM,mBAAmB,GAAG,UAAC,MAAe;;IAC1C,OAAO,CAAA,MAAA,MAAM,CAAC,aAAa,CAAC,0CAAE,OAAO,CAAC,UAAU,CAAC,IAAG,CAAC,CAAC,CAAA;AACxD,CAAC,CAAA;AAED,IAAM,oBAAoB,GAAG,UAAC,MAAe;IAC3C,OAAO,CACL,mBAAmB,CAAC,MAAM,CAAC;QAC3B,iBAAiB,CAAC,MAAM,CAAC;QACzB,mBAAmB,CAAC,MAAM,CAAC;QAC3B,iBAAiB,CAAC,MAAM,CAAC,CAC1B,CAAA;AACH,CAAC,CAAA;AAED,IAAM,KAAK,GAAG,UAAC,KAAa,IAAK,OAAA,KAAK,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,CAAC,GAAG,CAAC,UAAC,CAAC,EAAE,CAAC,IAAK,OAAA,CAAC,EAAD,CAAC,CAAC,EAA9C,CAA8C,CAAA;AAE/E,IAAM,qBAAqB,GAAG,UAC5B,gBAAwB,EACxB,qBAA6B,EAC7B,SAAiB;IAAjB,0BAAA,EAAA,iBAAiB;IAEjB,IAAI,SAAS,EAAE;QACb,OAAO,CAAC,CAAA;KACT;IACD,IAAI,gBAAgB,GAAG,qBAAqB;QAAE,OAAO,KAAK,CAAC,gBAAgB,CAAC,CAAA;IAE5E,OAAO,KAAK,CAAC,qBAAqB,CAAC,CAAA;AACrC,CAAC,CAAA;AAED,IAAM,gBAAgB,GAAG,UACvB,UAA6B,EAC7B,KAAa,EACb,SAAiB;IAAjB,0BAAA,EAAA,iBAAiB;IAEjB,IAAI,SAAS;QAAE,OAAO,KAAK,CAAA;IAC3B,IAAK,UAAuB,CAAC,MAAM,IAAI,KAAK;QAC1C,OAAQ,UAAuB,CAAC,MAAM,CAAC,KAAK,CAAC,CAAA;IAC/C,OAAQ,UAAuB,CAAC,MAAM,CAAC,UAAC,GAAG,EAAE,GAAG;QAC9C,IAAI,GAAG,GAAG,KAAK;YAAE,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA;QACvC,IAAI,GAAG,KAAK,KAAK;YAAE,OAAO,GAAG,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC,CAAA;QACpD,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC,CAAC,CAAA;IAC5B,CAAC,EAAE,EAAE,CAAC,CAAA;AACR,CAAC,CAAA;AAEY,QAAA,kBAAkB,GAAG,IAAA,uBAAQ,EACxC,IAAA,iCAAe,EAAsB;IACnC,IAAI,EAAE,gBAAgB;IACtB,KAAK,EAAE;QACL,qBAAqB,EAAE;YACrB,IAAI,EAAE,MAAM;YACZ,OAAO,EAAE,CAAC;SACX;KACF;IACD,KAAK,EAAL,UAAM,KAAK,EAAE,EAAS;YAAP,KAAK,WAAA;QAClB,IAAM,QAAQ,GAAG,IAAA,cAAQ,GAAc,CAAA;QACvC,IAAM,SAAS,GAAG,IAAA,oBAAc,GAAE,CAAA;QAElC,IAAM,SAAS,GAAG,UAAG,qBAAW,oBAAiB,CAAA;QACjD,IAAM,UAAU,GAA2B,IAAA,qBAAG,EAAC,EAAE,CAAC,CAAA;QAElD,IAAA,6BAAW,EAAC;YACV,IAAM,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAA;YAC5B,IAAM,UAAU,GAAG,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,EAAE,CAAA;YACxE,IAAI,CAAC,KAAK,CAAC,QAAQ,IAAI,UAAU,CAAC,MAAM,EAAE;gBACxC,UAAU,CAAC,KAAK,GAAG,qBAAqB,CACtC,UAAU,CAAC,MAAM,EACjB,KAAK,CAAC,qBAAqB,EAC3B,KAAK,CAAC,SAAoB,CAC3B,CAAA;aACF;QACH,CAAC,CAAC,CAAA;QAEI,IAAA,KAAqB,sBAAS,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,EAApD,MAAM,YAAA,EAAE,MAAM,YAAsC,CAAA;QAE5D,OAAO;YACL,IAAM,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAA;YAC5B,IAAM,MAAM,GAAG,SAAS,CAAC,KAAK,CAAA;YAC9B,IAAM,UAAU,GAAG,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,EAAE,CAAA;YACxE,IAAI,CAAC,MAAM;gBAAE,MAAM,IAAI,KAAK,CAAC,6BAA6B,CAAC,CAAA;YAE3D,IAAM,WAAW,GAAG;gBAClB,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE;oBACtB,OAAO,IAAI,CAAA;iBACZ;gBAED,IAAM,KAAK,GAAG,UAAU,aAAV,UAAU,uBAAV,UAAU,CAAE,GAAG,CAAC,UAAC,IAAI,EAAE,KAAK;oBACxC,IAAM,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC;wBACvC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;wBACxC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAA;oBAChB,IAAM,GAAG,GAAG,MAAM,CAAC,IAAI,EAAE,KAAK,CAAC,CAAA;oBAC/B,IAAM,UAAU,GAAG,KAAK;yBACrB,KAAK,CAAC,UAAG,KAAK,CAAC,OAAO,cAAI,KAAK,CAAE,CAAC;yBAClC,GAAG,CAAC,gBAAgB,CAAC,CAAA;oBACxB,IAAM,KAAK,GAAsB,KAAK,CAAC,mBAAmB,CAAC,CAAA;oBAC3D,IAAM,WAAW,GAAG,CAAA,UAAU,aAAV,UAAU,uBAAV,UAAU,CAAE,KAAK,KAAI,KAAK,CAAC,KAAK,IAAI,KAAK,CAAC,KAAK,CAAA;oBACnE,IAAM,IAAI,GAAG,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAA;oBACxC,IAAM,MAAM,GAAG,KAAK,CAAC,IAAI,CAAC,cAAc,CAAC;wBACvC,IAAI,EAAE,OAAO;wBACb,OAAO,EAAE,UAAG,IAAI,QAAK;qBACtB,CAAC,CAAA;oBAEF,IAAM,KAAK,GAAG,IAAA,OAAC,EACb,sBAAS,CAAC,IAAI,EACd;wBACE,KAAK,EAAE;4BACL,KAAK,OAAA;4BACL,MAAM,EAAE,IAAI;yBACb;qBACF,EACD;wBACE,OAAO,EAAE,cAAM,OAAA;4BACb,IAAA,OAAC,EACC,oBAAc,EACd;gCACE,KAAK,EAAE;oCACL,MAAM,EAAE,KAAK;oCACb,IAAI,EAAE,KAAK;oCACX,gBAAgB,EAAE,UAAC,MAAM;wCACvB,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC;4CAAE,OAAO,KAAK,CAAA;wCAC3C,OAAO,IAAI,CAAA;oCACb,CAAC;oCACD,oBAAoB,EAAE,IAAI;iCAC3B;6BACF,EACD,EAAE,CACH;4BACD,MAAM,CAAC,MAAM;gCACX,CAAC,CAAC,IAAA,OAAC,EACC,kBAAK,EACL;oCACE,KAAK,EAAE,CAAC,UAAG,SAAS,kBAAe,CAAC;oCACpC,KAAK,EAAE;wCACL,KAAK,EAAE,MAAM,CAAC,MAAM;qCACrB;iCACF,EACD,EAAE,OAAO,EAAE,cAAM,OAAA,WAAW,EAAX,CAAW,EAAE,CAC/B;gCACH,CAAC,CAAC,WAAW;yBAChB,EA5Bc,CA4Bd;qBACF,CACF,CAAA;oBACD,IAAM,KAAK,GAAG,IAAA,OAAC,EACb,sBAAS,CAAC,IAAI,EACd;wBACE,KAAK,EAAE;4BACL,KAAK,OAAA;4BACL,MAAM,EAAE,IAAI;yBACb;qBACF,EACD;wBACE,OAAO,EAAE,cAAM,OAAA;4BACb,IAAA,OAAC,EACC,oBAAc,EACd;gCACE,KAAK,EAAE;oCACL,MAAM,EAAE,KAAK;oCACb,IAAI,EAAE,KAAK;oCACX,gBAAgB,EAAE,UAAC,MAAM;wCACvB,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAAC;4CAAE,OAAO,KAAK,CAAA;wCAC/C,OAAO,IAAI,CAAA;oCACb,CAAC;oCACD,oBAAoB,EAAE,IAAI;iCAC3B;6BACF,EACD,EAAE,CACH;yBACF,EAhBc,CAgBd;qBACF,CACF,CAAA;oBACD,IAAM,OAAO,GAAG,IAAA,OAAC,EACf,oBAAc,EACd;wBACE,KAAK,EAAE;4BACL,MAAM,EAAE,KAAK;4BACb,IAAI,EAAE,KAAK;4BACX,gBAAgB,EAAE,UAAC,MAAM;gCACvB,IAAI,gBAAgB,CAAC,MAAM,CAAC;oCAAE,OAAO,KAAK,CAAA;gCAC1C,IAAI,oBAAoB,CAAC,MAAM,CAAC;oCAAE,OAAO,KAAK,CAAA;gCAC9C,OAAO,IAAI,CAAA;4BACb,CAAC;yBACF;qBACF,EACD,EAAE,CACH,CAAA;oBAED,OAAO,IAAA,OAAC,EACN,yBAAY,EACZ;wBACE,KAAK,iCACA,KAAK,GACL,UAAU,KACb,IAAI,EAAE,KAAK,GACZ;wBACD,GAAG,KAAA;qBACJ,EACD;wBACE,OAAO,EAAE,cAAM,OAAA;4BACb,IAAA,OAAC,EACC,sBAAS,CAAC,IAAI,EACd;gCACE,KAAK,EAAE;oCACL,KAAK,OAAA;oCACL,MAAM,EAAE,IAAI;iCACb;6BACF,EACD;gCACE,OAAO,EAAE,cAAM,OAAA,CAAC,OAAO,CAAC,EAAT,CAAS;6BACzB,CACF;yBACF,EAbc,CAad;wBACD,KAAK,EAAE;4BACL,OAAA,IAAA,OAAC,EACC,gBAAG,EACH;gCACE,KAAK,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE;gCAClB,KAAK,EAAE;oCACL,IAAI,EAAE,MAAM;oCACZ,OAAO,EAAE,eAAe;iCACzB;6BACF,EACD;gCACE,OAAO,EAAE,cAAM,OAAA;oCACb,IAAA,OAAC,EAAC,MAAM,EAAE,EAAE,EAAE,EAAE,OAAO,EAAE,cAAM,OAAA,KAAK,EAAL,CAAK,EAAE,CAAC;oCACvC,IAAA,OAAC,EAAC,MAAM,EAAE,EAAE,EAAE,EAAE,OAAO,EAAE,cAAM,OAAA,KAAK,EAAL,CAAK,EAAE,CAAC;iCACxC,EAHc,CAGd;6BACF,CACF;wBAfD,CAeC;qBACJ,CACF,CAAA;gBACH,CAAC,CAAC,CAAA;gBAEF,OAAO,IAAA,OAAC,EACN,qBAAQ,EACR;oBACE,KAAK,EAAE,CAAC,UAAG,SAAS,UAAO,CAAC;oBAC5B,KAAK,wBACA,KAAK,KACR,KAAK,EAAE,UAAU,CAAC,KAAK,GACxB;oBACD,EAAE,EAAE;wBACF,MAAM,EAAE,UAAC,IAAuB;4BAC9B,UAAU,CAAC,KAAK,GAAG,IAAI,CAAA;wBACzB,CAAC;qBACF;iBACF,EACD;oBACE,OAAO,EAAE,cAAM,OAAA,CAAC,KAAK,CAAC,EAAP,CAAO;iBACvB,CACF,CAAA;YACH,CAAC,CAAA;YACD,IAAM,cAAc,GAAG;gBACrB,OAAO,MAAM,CAAC,gBAAgB,CAAC,UAAC,QAAQ,EAAE,MAAM;oBAC9C,IAAI,mBAAmB,CAAC,MAAM,CAAC,EAAE;wBAC/B,OAAO,IAAA,OAAC,EACN,oBAAc,EACd;4BACE,KAAK,EAAE;gCACL,MAAM,QAAA;gCACN,IAAI,EAAE,UAAU;6BACjB;yBACF,EACD,EAAE,CACH,CAAA;qBACF;oBACD,OAAO,QAAQ,CAAA;gBACjB,CAAC,EAAE,IAAI,CAAC,CAAA;YACV,CAAC,CAAA;YACD,IAAM,WAAW,GAAG;gBAClB,IAAI,UAAU,aAAV,UAAU,uBAAV,UAAU,CAAE,MAAM;oBAAE,OAAM;gBAC9B,OAAO,IAAA,OAAC,EACN,iBAAI,EACJ;oBACE,KAAK,EAAE,CAAC,UAAG,SAAS,UAAO,CAAC;oBAC5B,KAAK,sBACH,MAAM,EAAE,OAAO,IACZ,KAAK,KACR,MAAM,EAAE,KAAK,CAAC,KAAK,IAAI,KAAK,CAAC,KAAK,GACnC;iBACF,EACD;oBACE,OAAO,EAAE;wBACP,OAAA,IAAA,OAAC,EACC,kBAAK,EACL,EAAE,KAAK,EAAE,EAAE,WAAW,EAAE,SAAS,EAAE,SAAS,EAAE,GAAG,EAAE,EAAE,EACrD,EAAE,CACH;oBAJD,CAIC;iBACJ,CACF,CAAA;YACH,CAAC,CAAA;YAED,OAAO,IAAA,OAAC,EACN,KAAK,EACL;gBACE,KAAK,EAAE,CAAC,SAAS,CAAC;aACnB,EACD;gBACE,OAAO,EAAE;oBACP,OAAA,IAAA,OAAC,EACC,sBAAS,EACT;wBACE,KAAK,EAAE;4BACL,MAAM,QAAA;yBACP;wBACD,EAAE,EAAE;4BACF,GAAG,EAAE,UAAC,KAAa;gCACjB,UAAU,CAAC,KAAK,GAAG,gBAAgB,CACjC,UAAU,CAAC,KAAK,EAChB,KAAK,EACL,KAAK,CAAC,SAAoB,CAC3B,CAAA;4BACH,CAAC;yBACF;qBACF,EACD;wBACE,OAAO,EAAE,cAAM,OAAA;4BACb,WAAW,EAAE;4BACb,WAAW,EAAE;4BACb,cAAc,EAAE;yBACjB,EAJc,CAId;qBACF,CACF;gBAvBD,CAuBC;aACJ,CACF,CAAA;QACH,CAAC,CAAA;IACH,CAAC;CACF,CAAC,CACH,CAAA;AAEY,QAAA,iBAAiB,GAAG,IAAA,iCAAe,EAAoB;IAClE,IAAI,EAAE,oBAAoB;IAC1B,KAAK,YAAC,MAAM,EAAE,EAAS;YAAP,KAAK,WAAA;QACnB,OAAO,cAAM,OAAA,IAAA,OAAC,EAAC,cAAQ,EAAE,EAAE,EAAE,KAAK,CAAC,EAAtB,CAAsB,CAAA;IACrC,CAAC;CACF,CAAC,CAAA;AAEW,QAAA,aAAa,GAAG,IAAA,sBAAa,EAAC,0BAAkB,EAAE;IAC7D,IAAI,EAAE,yBAAiB;IACvB,KAAK,EAAE,sBAAS,CAAC,KAAK;IACtB,UAAU,EAAE,sBAAS,CAAC,UAAU;IAChC,QAAQ,EAAE,sBAAS,CAAC,QAAQ;IAC5B,MAAM,EAAE,sBAAS,CAAC,MAAM;IACxB,QAAQ,EAAE,sBAAS,CAAC,QAAQ;IAC5B,MAAM,EAAE,sBAAS,CAAC,MAAM;IACxB,QAAQ,EAAE,sBAAS,CAAC,QAAQ;IAC5B,QAAQ,EAAE,sBAAS,CAAC,QAAQ;IAC5B,SAAS,EAAE,sBAAS,CAAC,SAAS;CAC/B,CAAC,CAAA;AAEF,kBAAe,qBAAa,CAAA","sourcesContent":["import { defineComponent, ref, watchEffect, Ref } from '@vue/composition-api'\nimport { Card, Collapse, CollapseItem, Empty, Row, Badge } from 'element-ui'\nimport { ArrayField } from '@formily/core'\nimport type {\n  Collapse as CollapseProps,\n  CollapseItem as CollapseItemProps,\n} from 'element-ui'\nimport {\n  useField,\n  useFieldSchema,\n  RecursionField,\n  h,\n  Fragment,\n} from '@formily/vue'\nimport { observer } from '@formily/reactive-vue'\nimport { ISchema } from '@formily/json-schema'\nimport { stylePrefix } from '../__builtins__/configs'\nimport { ArrayBase } from '../array-base'\nimport { composeExport } from '../__builtins__/shared'\n\nexport interface IArrayCollapseProps extends CollapseProps {\n  defaultOpenPanelCount?: number\n}\n\nconst isAdditionComponent = (schema: ISchema) => {\n  return schema['x-component']?.indexOf('Addition') > -1\n}\n\nconst isIndexComponent = (schema: ISchema) => {\n  return schema['x-component']?.indexOf('Index') > -1\n}\n\nconst isRemoveComponent = (schema: ISchema) => {\n  return schema['x-component']?.indexOf('Remove') > -1\n}\n\nconst isMoveUpComponent = (schema: ISchema) => {\n  return schema['x-component']?.indexOf('MoveUp') > -1\n}\n\nconst isMoveDownComponent = (schema: ISchema) => {\n  return schema['x-component']?.indexOf('MoveDown') > -1\n}\n\nconst isOperationComponent = (schema: ISchema) => {\n  return (\n    isAdditionComponent(schema) ||\n    isRemoveComponent(schema) ||\n    isMoveDownComponent(schema) ||\n    isMoveUpComponent(schema)\n  )\n}\n\nconst range = (count: number) => Array.from({ length: count }).map((_, i) => i)\n\nconst takeDefaultActiveKeys = (\n  dataSourceLength: number,\n  defaultOpenPanelCount: number,\n  accordion = false\n) => {\n  if (accordion) {\n    return 0\n  }\n  if (dataSourceLength < defaultOpenPanelCount) return range(dataSourceLength)\n\n  return range(defaultOpenPanelCount)\n}\n\nconst insertActiveKeys = (\n  activeKeys: number[] | number,\n  index: number,\n  accordion = false\n) => {\n  if (accordion) return index\n  if ((activeKeys as number[]).length <= index)\n    return (activeKeys as number[]).concat(index)\n  return (activeKeys as number[]).reduce((buf, key) => {\n    if (key < index) return buf.concat(key)\n    if (key === index) return buf.concat([key, key + 1])\n    return buf.concat(key + 1)\n  }, [])\n}\n\nexport const ArrayCollapseInner = observer(\n  defineComponent<IArrayCollapseProps>({\n    name: 'FArrayCollapse',\n    props: {\n      defaultOpenPanelCount: {\n        type: Number,\n        default: 5,\n      },\n    },\n    setup(props, { attrs }) {\n      const fieldRef = useField<ArrayField>()\n      const schemaRef = useFieldSchema()\n\n      const prefixCls = `${stylePrefix}-array-collapse`\n      const activeKeys: Ref<number[] | number> = ref([])\n\n      watchEffect(() => {\n        const field = fieldRef.value\n        const dataSource = Array.isArray(field.value) ? field.value.slice() : []\n        if (!field.modified && dataSource.length) {\n          activeKeys.value = takeDefaultActiveKeys(\n            dataSource.length,\n            props.defaultOpenPanelCount,\n            attrs.accordion as boolean\n          )\n        }\n      })\n\n      const { getKey, keyMap } = ArrayBase.useKey(schemaRef.value)\n\n      return () => {\n        const field = fieldRef.value\n        const schema = schemaRef.value\n        const dataSource = Array.isArray(field.value) ? field.value.slice() : []\n        if (!schema) throw new Error('can not found schema object')\n\n        const renderItems = () => {\n          if (!dataSource.length) {\n            return null\n          }\n\n          const items = dataSource?.map((item, index) => {\n            const items = Array.isArray(schema.items)\n              ? schema.items[index] || schema.items[0]\n              : schema.items\n            const key = getKey(item, index)\n            const panelProps = field\n              .query(`${field.address}.${index}`)\n              .get('componentProps')\n            const props: CollapseItemProps = items['x-component-props']\n            const headerTitle = panelProps?.title || props.title || field.title\n            const path = field.address.concat(index)\n            const errors = field.form.queryFeedbacks({\n              type: 'error',\n              address: `${path}.**`,\n            })\n\n            const title = h(\n              ArrayBase.Item,\n              {\n                props: {\n                  index,\n                  record: item,\n                },\n              },\n              {\n                default: () => [\n                  h(\n                    RecursionField,\n                    {\n                      props: {\n                        schema: items,\n                        name: index,\n                        filterProperties: (schema) => {\n                          if (!isIndexComponent(schema)) return false\n                          return true\n                        },\n                        onlyRenderProperties: true,\n                      },\n                    },\n                    {}\n                  ),\n                  errors.length\n                    ? h(\n                        Badge,\n                        {\n                          class: [`${prefixCls}-errors-badge`],\n                          props: {\n                            value: errors.length,\n                          },\n                        },\n                        { default: () => headerTitle }\n                      )\n                    : headerTitle,\n                ],\n              }\n            )\n            const extra = h(\n              ArrayBase.Item,\n              {\n                props: {\n                  index,\n                  record: item,\n                },\n              },\n              {\n                default: () => [\n                  h(\n                    RecursionField,\n                    {\n                      props: {\n                        schema: items,\n                        name: index,\n                        filterProperties: (schema) => {\n                          if (!isOperationComponent(schema)) return false\n                          return true\n                        },\n                        onlyRenderProperties: true,\n                      },\n                    },\n                    {}\n                  ),\n                ],\n              }\n            )\n            const content = h(\n              RecursionField,\n              {\n                props: {\n                  schema: items,\n                  name: index,\n                  filterProperties: (schema) => {\n                    if (isIndexComponent(schema)) return false\n                    if (isOperationComponent(schema)) return false\n                    return true\n                  },\n                },\n              },\n              {}\n            )\n\n            return h(\n              CollapseItem,\n              {\n                attrs: {\n                  ...props,\n                  ...panelProps,\n                  name: index,\n                },\n                key,\n              },\n              {\n                default: () => [\n                  h(\n                    ArrayBase.Item,\n                    {\n                      props: {\n                        index,\n                        record: item,\n                      },\n                    },\n                    {\n                      default: () => [content],\n                    }\n                  ),\n                ],\n                title: () =>\n                  h(\n                    Row,\n                    {\n                      style: { flex: 1 },\n                      props: {\n                        type: 'flex',\n                        justify: 'space-between',\n                      },\n                    },\n                    {\n                      default: () => [\n                        h('span', {}, { default: () => title }),\n                        h('span', {}, { default: () => extra }),\n                      ],\n                    }\n                  ),\n              }\n            )\n          })\n\n          return h(\n            Collapse,\n            {\n              class: [`${prefixCls}-item`],\n              attrs: {\n                ...attrs,\n                value: activeKeys.value,\n              },\n              on: {\n                change: (keys: number[] | number) => {\n                  activeKeys.value = keys\n                },\n              },\n            },\n            {\n              default: () => [items],\n            }\n          )\n        }\n        const renderAddition = () => {\n          return schema.reduceProperties((addition, schema) => {\n            if (isAdditionComponent(schema)) {\n              return h(\n                RecursionField,\n                {\n                  props: {\n                    schema,\n                    name: 'addition',\n                  },\n                },\n                {}\n              )\n            }\n            return addition\n          }, null)\n        }\n        const renderEmpty = () => {\n          if (dataSource?.length) return\n          return h(\n            Card,\n            {\n              class: [`${prefixCls}-item`],\n              attrs: {\n                shadow: 'never',\n                ...attrs,\n                header: attrs.title || field.title,\n              },\n            },\n            {\n              default: () =>\n                h(\n                  Empty,\n                  { props: { description: 'No Data', imageSize: 100 } },\n                  {}\n                ),\n            }\n          )\n        }\n\n        return h(\n          'div',\n          {\n            class: [prefixCls],\n          },\n          {\n            default: () =>\n              h(\n                ArrayBase,\n                {\n                  props: {\n                    keyMap,\n                  },\n                  on: {\n                    add: (index: number) => {\n                      activeKeys.value = insertActiveKeys(\n                        activeKeys.value,\n                        index,\n                        attrs.accordion as boolean\n                      )\n                    },\n                  },\n                },\n                {\n                  default: () => [\n                    renderEmpty(),\n                    renderItems(),\n                    renderAddition(),\n                  ],\n                }\n              ),\n          }\n        )\n      }\n    },\n  })\n)\n\nexport const ArrayCollapseItem = defineComponent<CollapseItemProps>({\n  name: 'FArrayCollapseItem',\n  setup(_props, { slots }) {\n    return () => h(Fragment, {}, slots)\n  },\n})\n\nexport const ArrayCollapse = composeExport(ArrayCollapseInner, {\n  Item: ArrayCollapseItem,\n  Index: ArrayBase.Index,\n  SortHandle: ArrayBase.SortHandle,\n  Addition: ArrayBase.Addition,\n  Remove: ArrayBase.Remove,\n  MoveDown: ArrayBase.MoveDown,\n  MoveUp: ArrayBase.MoveUp,\n  useArray: ArrayBase.useArray,\n  useIndex: ArrayBase.useIndex,\n  useRecord: ArrayBase.useRecord,\n})\n\nexport default ArrayCollapse\n"]}
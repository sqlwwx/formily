{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/array-tabs/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { defineComponent, ref } from '@vue/composition-api'\nimport { observer } from '@formily/reactive-vue'\nimport { ArrayField } from '@formily/core'\nimport { h, useField, useFieldSchema, RecursionField } from '@formily/vue'\nimport { Tabs, TabPane, Badge, Button } from 'element-ui'\nimport { stylePrefix } from '../__builtins__/configs'\n\nimport type { Tabs as TabsProps } from 'element-ui'\n\nexport const ArrayTabs = observer(\n  defineComponent<TabsProps>({\n    name: 'ArrayTabs',\n    props: [],\n    setup(props, { attrs, listeners }) {\n      const fieldRef = useField<ArrayField>()\n      const schemaRef = useFieldSchema()\n\n      const prefixCls = `${stylePrefix}-array-tabs`\n      const activeKey = ref('tab-0')\n\n      return () => {\n        const field = fieldRef.value\n        const schema = schemaRef.value\n        const value = Array.isArray(field.value) ? field.value : []\n        const dataSource = value?.length ? value : [{}]\n\n        const onEdit = (targetKey: any, type: 'add' | 'remove') => {\n          if (type == 'add') {\n            const id = dataSource.length\n            if (field?.value?.length) {\n              field.push(null)\n            } else {\n              field.push(null, null)\n            }\n            activeKey.value = `tab-${id}`\n          } else if (type == 'remove') {\n            const index = targetKey.match(/-(\\d+)/)?.[1]\n            field.remove(Number(index))\n            if (activeKey.value === targetKey) {\n              activeKey.value = `tab-${index - 1}`\n            }\n          }\n        }\n\n        const badgedTab = (index: number) => {\n          const tab = `${field.title || 'Untitled'} ${index + 1}`\n          const path = field.address.concat(index)\n          const errors = field.form.queryFeedbacks({\n            type: 'error',\n            address: `${path}.**`,\n          })\n          if (errors.length) {\n            return h(\n              'span',\n              {},\n              {\n                default: () => [\n                  h(\n                    Badge,\n                    {\n                      class: [`${prefixCls}-errors-badge`],\n                      props: {\n                        value: errors.length,\n                      },\n                    },\n                    {\n                      default: () => [tab],\n                    }\n                  ),\n                ],\n              }\n            )\n          }\n          return h(\n            'span',\n            {},\n            {\n              default: () => [tab],\n            }\n          )\n        }\n\n        const renderItems = () =>\n          dataSource?.map((item, index) => {\n            const items = Array.isArray(schema.items)\n              ? schema.items[index]\n              : schema.items\n            const key = `tab-${index}`\n\n            return h(\n              TabPane,\n              {\n                key,\n                attrs: {\n                  closable: index !== 0,\n                  name: key,\n                },\n              },\n              {\n                default: () =>\n                  h(\n                    RecursionField,\n                    {\n                      props: {\n                        schema: items,\n                        name: index,\n                      },\n                    },\n                    {}\n                  ),\n\n                label: () => [badgedTab(index)],\n              }\n            )\n          })\n        return h(\n          Tabs,\n          {\n            class: [prefixCls],\n            attrs: {\n              ...attrs,\n              type: 'card',\n              value: activeKey.value,\n              addable: true,\n            },\n            on: {\n              ...listeners,\n              input: (key) => {\n                activeKey.value = key\n              },\n              'tab-remove': (target) => {\n                onEdit(target, 'remove')\n                listeners?.['tab-remove']?.(target)\n              },\n              'tab-add': () => {\n                onEdit(null, 'add')\n                listeners?.['tab-add']?.()\n              },\n            },\n          },\n          {\n            default: () => [renderItems()],\n          }\n        )\n      }\n    },\n  })\n)\n\nexport default ArrayTabs\n"]}
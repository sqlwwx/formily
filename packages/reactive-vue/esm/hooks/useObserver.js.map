{"version":3,"file":"useObserver.js","sourceRoot":"","sources":["../../src/hooks/useObserver.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,OAAO,EAAE,MAAM,mBAAmB,CAAA;AAC3C,OAAO,EAAE,kBAAkB,EAAE,eAAe,EAAE,MAAM,EAAE,MAAM,UAAU,CAAA;AAEtE,0BAA0B;AAC1B,MAAM,CAAC,IAAM,WAAW,GAAG;IACzB,IAAI,MAAM,EAAE;QACV,IAAM,IAAE,GAAG,kBAAkB,EAAE,CAAA;QAE/B,IAAI,SAA+B,CAAA;QAEnC,eAAe,CAAC;YACd,IAAI,SAAO,EAAE;gBACX,SAAO,EAAE,CAAA;aACV;QACH,CAAC,CAAC,CAAA;QAEF,MAAM,CAAC,cAAc,CAAC,IAAE,EAAE,QAAQ,EAAE;YAClC,GAAG;gBACD,OAAO,IAAE,CAAC,eAAe,CAAC,CAAA;YAC5B,CAAC;YACD,GAAG,YAAC,QAAQ;gBACV,IAAI,SAAO,EAAE;oBACX,SAAO,EAAE,CAAA;iBACV;gBACD,SAAO,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAA;gBAC3B,IAAE,CAAC,eAAe,CAAC,GAAG,QAAQ,CAAA;YAChC,CAAC;SACF,CAAC,CAAA;KACH;AACH,CAAC,CAAA","sourcesContent":["import { autorun } from '@formily/reactive'\nimport { getCurrentInstance, onBeforeUnmount, isVue3 } from 'vue-demi'\n\n/* istanbul ignore next */\nexport const useObserver = () => {\n  if (isVue3) {\n    const vm = getCurrentInstance()\n\n    let dispose: () => void | undefined\n\n    onBeforeUnmount(() => {\n      if (dispose) {\n        dispose()\n      }\n    })\n\n    Object.defineProperty(vm, 'update', {\n      get() {\n        return vm['_updateEffect']\n      },\n      set(newValue) {\n        if (dispose) {\n          dispose()\n        }\n        dispose = autorun(newValue)\n        vm['_updateEffect'] = newValue\n      },\n    })\n  }\n}\n"]}
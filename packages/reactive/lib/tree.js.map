{"version":3,"file":"tree.js","sourceRoot":"","sources":["../src/tree.ts"],"names":[],"mappings":";;;AAAA,6CAAiD;AAGjD;IAOE,oBAAY,SAAqB,EAAE,IAAc;QAC/C,IAAI,CAAC,GAAG,GAAG,SAAS,CAAC,GAAG,CAAA;QACxB,IAAI,CAAC,IAAI,GAAG,SAAS,CAAC,IAAI,CAAA;QAC1B,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC,MAAM,CAAA;QAC9B,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC,KAAK,CAAA;QAC5B,IAAI,CAAC,QAAQ,GAAG,SAAS,CAAC,QAAQ,CAAA;QAClC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,CAAA;IAC7C,CAAC;IACH,iBAAC;AAAD,CAAC,AAfD,IAeC;AAfY,gCAAU;AAgBvB;IAOE,kBAAY,MAAW,EAAE,GAAgB,EAAE,KAAU;QACnD,IAAI,CAAC,MAAM,GAAG,MAAM,CAAA;QACpB,IAAI,CAAC,GAAG,GAAG,GAAG,CAAA;QACd,IAAI,CAAC,KAAK,GAAG,KAAK,CAAA;IACpB,CAAC;IAED,sBAAI,0BAAI;aAAR;YACE,IAAI,CAAC,IAAI,CAAC,MAAM;gBAAE,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAA;YACnD,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;QAC1C,CAAC;;;OAAA;IAED,sBAAI,+BAAS;aAAb;YACE,OAAO,sBAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC,MAAM,CAAA;QACjD,CAAC;;;OAAA;IAED,sBAAI,4BAAM;aAAV;YACE,IAAI,CAAC,IAAI,CAAC,MAAM;gBAAE,OAAM;YACxB,OAAO,qBAAO,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,CAAA;QACpC,CAAC;;;OAAA;IAED,0BAAO,GAAP,UAAQ,IAAc;QACpB,IAAI,IAAI,CAAC,GAAG,EAAE;YACZ,OAAO,IAAI,CAAC,SAAS,KAAK,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,GAAG,KAAK,IAAI,CAAC,GAAG,CAAA;SAClE;QACD,OAAO,IAAI,CAAC,KAAK,KAAK,IAAI,CAAC,KAAK,CAAA;IAClC,CAAC;IAED,2BAAQ,GAAR,UAAS,IAAc;QACrB,IAAI,IAAI,KAAK,IAAI;YAAE,OAAO,IAAI,CAAA;QAC9B,IAAI,MAAM,GAAG,IAAI,CAAC,MAAM,CAAA;QACxB,OAAO,CAAC,CAAC,MAAM,EAAE;YACf,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;gBAAE,OAAO,IAAI,CAAA;YACrC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAA;SACvB;QACD,OAAO,KAAK,CAAA;IACd,CAAC;IACH,eAAC;AAAD,CAAC,AA3CD,IA2CC;AA3CY,4BAAQ;AA6Cd,IAAM,aAAa,GAAG,UAAC,MAAW,EAAE,GAAgB,EAAE,KAAU;IACrE,IAAM,WAAW,GAAG,qBAAO,CAAC,GAAG,CAAC,sBAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,KAAK,CAAC,CAAA;IAC7D,IAAI,WAAW;QAAE,OAAO,WAAW,CAAA;IACnC,qBAAO,CAAC,GAAG,CAAC,KAAK,EAAE,IAAI,QAAQ,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC,CAAA;AACtD,CAAC,CAAA;AAJY,QAAA,aAAa,iBAIzB","sourcesContent":["import { ProxyRaw, RawNode } from './environment'\nimport { ObservablePath, PropertyKey, IOperation } from './types'\n\nexport class DataChange {\n  path: ObservablePath\n  key: PropertyKey\n  object: object\n  type: string\n  value: any\n  oldValue: any\n  constructor(operation: IOperation, node: DataNode) {\n    this.key = operation.key\n    this.type = operation.type\n    this.object = operation.target\n    this.value = operation.value\n    this.oldValue = operation.oldValue\n    this.path = node.path.concat(operation.key)\n  }\n}\nexport class DataNode {\n  target: any\n\n  key: PropertyKey\n\n  value: any\n\n  constructor(target: any, key: PropertyKey, value: any) {\n    this.target = target\n    this.key = key\n    this.value = value\n  }\n\n  get path() {\n    if (!this.parent) return this.key ? [this.key] : []\n    return this.parent.path.concat(this.key)\n  }\n\n  get targetRaw() {\n    return ProxyRaw.get(this.target) || this.target\n  }\n\n  get parent() {\n    if (!this.target) return\n    return RawNode.get(this.targetRaw)\n  }\n\n  isEqual(node: DataNode) {\n    if (this.key) {\n      return node.targetRaw === this.targetRaw && node.key === this.key\n    }\n    return node.value === this.value\n  }\n\n  contains(node: DataNode) {\n    if (node === this) return true\n    let parent = node.parent\n    while (!!parent) {\n      if (this.isEqual(parent)) return true\n      parent = parent.parent\n    }\n    return false\n  }\n}\n\nexport const buildDataTree = (target: any, key: PropertyKey, value: any) => {\n  const currentNode = RawNode.get(ProxyRaw.get(value) || value)\n  if (currentNode) return currentNode\n  RawNode.set(value, new DataNode(target, key, value))\n}\n"]}
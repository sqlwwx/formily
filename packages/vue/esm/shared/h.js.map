{"version":3,"file":"h.js","sourceRoot":"","sources":["../../src/shared/h.ts"],"names":[],"mappings":"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","sourcesContent":["import { h, isVue2 } from 'vue-demi'\nimport { Fragment, FragmentComponent } from './fragment'\n\ntype RenderChildren = {\n  [key in string]?: (...args: any[]) => (VNode | string)[]\n}\n\n// TODO: need to compatible with vue2 & vue3\ntype Tag = any\ntype VNodeData = Record<string, any>\ntype VNode = any\ntype VNodeChildren = any\n\nconst compatibleCreateElement = (\n  tag: Tag,\n  data: VNodeData,\n  components: RenderChildren\n): any => {\n  /* istanbul ignore else */\n  if (isVue2) {\n    const hInVue2 = h as (\n      tag: Tag,\n      data?: VNodeData,\n      components?: VNodeChildren\n    ) => VNode\n    const scopedSlots = components // 默认全部作为 scopedSlots 处理\n    const children = []\n\n    /**\n     * scopedSlots 不会映射为slots，所以这里手动映射一遍\n     * 主要为了解决 slots.x 问题\n     */\n    Object.keys(components).forEach((key) => {\n      const func = components[key]\n\n      // 转换为 slots 传递\n      if (typeof func === 'function' && func.length === 0) {\n        /**\n         * func 参数为0的判断不准确，因为composition-api包了一层，导致全部为0\n         * try catch 解决scoped slots 转换参数异常问题\n         * */\n        try {\n          const child = func()\n          children.push(\n            key === 'default'\n              ? child\n              : hInVue2(FragmentComponent, { slot: key }, [child])\n          )\n        } catch (error) {}\n      }\n    })\n    const newData = Object.assign({}, data)\n    if (Object.keys(scopedSlots).length > 0) {\n      if (!newData.scopedSlots) {\n        newData.scopedSlots = scopedSlots\n      } else {\n        newData.scopedSlots = {\n          ...newData.scopedSlots,\n          ...scopedSlots,\n        }\n      }\n    }\n    if (tag === Fragment) {\n      if (Object.keys(newData).length === 0 && children.length === 1) {\n        if (!Array.isArray(children[0])) {\n          return children[0]\n        } else if (children[0].length === 1) {\n          return children[0][0]\n        }\n      }\n      tag = FragmentComponent\n    }\n    return hInVue2(tag, newData, children)\n  } else {\n    if (tag === Fragment) {\n      tag = FragmentComponent\n    }\n    const hInVue3 = h as (\n      tag: Tag,\n      data?: VNodeData,\n      components?: RenderChildren\n    ) => VNode\n    const newData = {}\n    Object.keys(data).forEach((key) => {\n      if (key === 'on') {\n        if (data[key]) {\n          const events = Object.keys(data[key])\n          events.forEach((event) => {\n            const eventName = `on${event[0].toUpperCase()}${event.slice(1)}`\n            newData[eventName] = data[key][event]\n          })\n        }\n      } else if (typeof data[key] === 'object' && data[key] !== null) {\n        Object.assign(newData, data[key])\n      } else {\n        newData[key] = data[key]\n      }\n    })\n    return hInVue3(tag, newData, components)\n  }\n}\n\nexport default compatibleCreateElement\n\nexport { compatibleCreateElement as h }\n"]}
{"version":3,"file":"useAttach.js","sourceRoot":"","sources":["../../src/hooks/useAttach.ts"],"names":[],"mappings":";;;AAAA,qCAAsE;AAO/D,IAAM,SAAS,GAAG,UACvB,MAAS;IAET,IAAM,YAAY,GAAG,IAAA,qBAAU,EAAI,IAAI,CAAC,CAAA;IACxC,YAAY,CAAC,KAAK,GAAG,MAAM,CAAA;IAC3B,IAAA,oBAAS,EAAC;QACR,MAAM,CAAC,OAAO,EAAE,CAAA;IAClB,CAAC,CAAC,CAAA;IAEF,IAAA,0BAAe,EAAC;;QACd,MAAA,YAAY,CAAC,KAAK,0CAAE,SAAS,EAAE,CAAA;IACjC,CAAC,CAAC,CAAA;IAEF,IAAM,OAAO,GAAG,UAAC,MAAS;QACxB,IAAI,MAAM,KAAK,YAAY,CAAC,KAAK,EAAE;YACjC,IAAI,YAAY,CAAC,KAAK,EAAE;gBACtB,YAAY,CAAC,KAAK,CAAC,SAAS,EAAE,CAAA;aAC/B;YACD,YAAY,CAAC,KAAK,GAAG,MAAM,CAAA;YAC3B,MAAM,CAAC,OAAO,EAAE,CAAA;SACjB;QACD,OAAO,YAAY,CAAC,KAAU,CAAA;IAChC,CAAC,CAAA;IAED,OAAO,CAAC,YAAY,EAAE,OAAO,CAAC,CAAA;AAChC,CAAC,CAAA;AAzBY,QAAA,SAAS,aAyBrB","sourcesContent":["import { onBeforeUnmount, onMounted, shallowRef, Ref } from 'vue-demi'\n\ninterface IRecycleTarget {\n  onMount: () => void\n  onUnmount: () => void\n}\n\nexport const useAttach = <T extends IRecycleTarget>(\n  target: T\n): [Ref<T>, (arg: T) => T] => {\n  const oldTargetRef = shallowRef<T>(null)\n  oldTargetRef.value = target\n  onMounted(() => {\n    target.onMount()\n  })\n\n  onBeforeUnmount(() => {\n    oldTargetRef.value?.onUnmount()\n  })\n\n  const checker = (target: T) => {\n    if (target !== oldTargetRef.value) {\n      if (oldTargetRef.value) {\n        oldTargetRef.value.onUnmount()\n      }\n      oldTargetRef.value = target\n      target.onMount()\n    }\n    return oldTargetRef.value as T\n  }\n\n  return [oldTargetRef, checker]\n}\n"]}